(define "EnemyOutsideCentre"
    (and 
        (is Enemy (who at:(between))) 
        (not (= (centrePoint) (between)))
    )
)

(define "FlankFromOrthogonalStep"
    (or {
        (can Move ("Custodial" (from (ahead (last To) N))))
        (can Move ("Custodial" (from (ahead (last To) E))))
        (can Move ("Custodial" (from (ahead (last To) W))))
        (can Move ("Custodial" (from (ahead (last To) S))))
    })
)

(define "CaptureAndMoveAgain" 
    (apply 
        (and 
            (remove (between)) 
            (if 
                "FlankFromOrthogonalStep"
                (moveAgain)
                (if (no Moves Next) 
                    (and 
                        (set Pending) 
                        (moveAgain) 
                    )
                )
            ) 
        )
    )
)

(define "Custodial"
    (custodial 
        #1
        Orthogonal
        (between 
            (max 1) 
            if:"EnemyOutsideCentre"
            #2
        )
        (to if:(is Friend (who at:(to))))
    )
)

//------------------------------------------------------------------------------

(game "Seega"  
    (players 2)  
    (equipment { 
        (board (square <Board:size>)) 
        (hand Each) 
        
        (piece "Ball" Each 
            (move
                Step
                Orthogonal 
                (to if:(is Empty (to)))
                (then
                    ("Custodial" (from (last To)) "CaptureAndMoveAgain")
                )
            )
        )
    }) 
    
    (rules 
        (start (place "Ball" "Hand" count:<Board:numPieces>))
        phases:{
        (phase "Placement"
            (play 
                (move 
                    (from (handSite Mover)) 
                    (to (difference (sites Empty) (centrePoint))) 
                    (then 
                        (if 
                            (not "SameTurn") 
                            (moveAgain)
                        )
                    )
                ) 
            ) 
            (nextPhase Mover ("HandEmpty" Mover) "Movement")
        )
        (phase "Movement" 
            (play 
                (if "SameTurn"
                    (move
                        Step
                        (from (last To)) 
                        Orthogonal 
                        (to if:(and 
                                (is Empty (to)) 
                                (or {
                                    (and (is Enemy (who at:(ahead (to) W))) (is Friend (who at:(ahead (ahead (to) W) W))) )  
                                    (and (is Enemy (who at:(ahead (to) E))) (is Friend (who at:(ahead (ahead (to) E) E))) )  
                                    (and (is Enemy (who at:(ahead (to) N))) (is Friend (who at:(ahead (ahead (to) N) N))) )  
                                    (and (is Enemy (who at:(ahead (to) S))) (is Friend (who at:(ahead (ahead (to) S) S))) )  
                                }) 
                            )
                        )
                        (then
                            ("Custodial" (from (last To)) "CaptureAndMoveAgain")
                        )
                    )
                    (forEach Piece) 
                )
            )
        )
        }
        
        (end (if ("NoPiece" Next) (result Mover Win)))
    )
)

//------------------------------------------------------------------------------

(option "Board Size" <Board> args:{ <size> <numPieces>}
    {
    (item "5x5"    <5>  <12>  "The game is played on a 5x5 board.")**   
    (item "7x7"    <7>  <24>  "The game is played on a 7x7 board.")   
    (item "9x9"    <9>  <40>  "The game is played on a 9x9 board.")   
})

//------------------------------------------------------------------------------

(rulesets { 
    
    (ruleset "Ruleset/Khamsawee (Observed)" 
        {
        "Board Size/5x5"
        }
    )*
    
    (ruleset "Ruleset/Sebawee (Observed)" 
        {
        "Board Size/7x7"
        }
    )
    
    (ruleset "Ruleset/Tisawee (Observed)" 
        {
        "Board Size/9x9"
        }
    )
    
})

//------------------------------------------------------------------------------

(metadata 
    
    (info
        {
        (description "Seega is a game played in North Africa, and is particularly well-known in Egypt and Sudan. It is a game that is similar to Draughts or Alquerque, but has a custodial capture mechanism instead of leaping. It has been documented since the nineteenth century, but is likely to be older. The boards are typically scooped out of the sand or etched into stone surfaces.")
        (aliases {"Siga" "Sija" "Seeja"})
        (useFor "Ruleset/Khamsawee (Observed)" (rules "5x5 board. Players begin by placing their pieces in prescribed spaces, and then alternating two-by-two in places as they see fit, except for the central space. Once all the spaces except the central one are filled, the first player moves a piece one space orthogonally to the empty space. Pieces are captured by surrounding them on either side by a player's own pieces. Multiple captures are allowed. The player to capture all of the opponent's pieces wins."))
        (useFor "Ruleset/Khamsawee (Observed)" (source "Lane 1836: 356-357; Davies 1925: 138-139; Bolton 190."))
        (useFor "Ruleset/Sebawee (Observed)" (rules "Same rules as Khamsáwee Seega with a 7x7 board. The number of pieces per player is unspecified."))
        (useFor "Ruleset/Sebawee (Observed)" (source "Lane 1836: 356-357."))
        (useFor "Ruleset/Tisawee (Observed)" (rules "Played with the same rules as Khamsáwee Seega, except played on a 9x9 board. The number of piece per player is not specified."))
        (useFor "Ruleset/Tisawee (Observed)" (source "Lane 1836: 356-357."))
        (source "Murray 1951: 54–55; Parker 1909: 603–604.")
        (version "1.0.8")
        (classification "board/war")
        (credit "Eric Piette")
        (origin  "This game was played in North Africa, from around 1825CE to 1925CE.")
        }
    )
    
    (graphics {
        (board Colour Phase0 (colour 223 178 110))
        (board Colour InnerEdges (colour Black))
        (board Colour OuterEdges (colour Black))
    })
    
    (ai 
        "Seega_ai"
    )
    
)
